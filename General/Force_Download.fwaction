<library-action name="ForceDownloadCommon"><action-markup custom name="php_code"><?php/****************************************************************** Force Download (PHP) action for Freeway* version 1.0***************************************************************** Upload your site to a PHP enabled server to run this script*****************************************************************/$filename = "__filename__";if(ini_get('zlib.output_compression'))  ini_set('zlib.output_compression', 'Off');$file_extension = strtolower(substr(strrchr($filename,"."),1));if( $filename == ""){  header("HTTP/1.0 404 Not Found");  header ("Location: ".getenv('HTTP_REFERER') );  exit;} elseif ( ! file_exists( $filename ) ) {    header("HTTP/1.0 404 Not Found");  header ("Location: ".getenv('HTTP_REFERER') );  exit;  };if ($file_extension == "php" || $file_extension == "php3"){	exit;}switch( $file_extension ){  case "pdf": $ctype="application/pdf"; break;  case "exe": $ctype="application/octet-stream"; break;  case "zip": $ctype="application/zip"; break;  case "doc": $ctype="application/msword"; break;  case "xls": $ctype="application/vnd.ms-excel"; break;  case "ppt": $ctype="application/vnd.ms-powerpoint"; break;  case "gif": $ctype="image/gif"; break;  case "png": $ctype="image/png"; break;  case "jpeg":  case "jpg": $ctype="image/jpg"; break;  default: $ctype="application/force-download";}header("Pragma: public");header("Expires: 0");header("Cache-Control: must-revalidate, post-check=0, pre-check=0");header("Cache-Control: private",false); header("Content-Type: $ctype");header("Content-Disposition: attachment; filename=\"".basename($filename)."\";" );header("Content-Transfer-Encoding: binary");header("Content-Length: ".filesize($filename));readfile("$filename");exit();?></action-markup></library-action><item-action name="Force Download (PHP)"><action-appliesto graphic image-map pass-through/><action-version version="1.0">	Force Download (PHP)		Copyright © Tim Plumb, 2008	Find other great actions at www.freewayactions.com</action-version><action-file name = "file_1" title="Download file" keepwithHTML><action-file var name = "php_file" keepwithHTML><action-include name="ForceDownloadCommon">	<action-javascript>		function fwBeforeEndBody() {			var img = fwDocument.fwTags.fwFind("img",fwItem);			if (img){				//create the php file based on the original file name				var origFileName = fwParameters["file_1"].fwValue;				var origFileNameNoExt = origFileName.split(".")[0];				var dlFileName = origFileNameNoExt + "-dl.php";										//create the php file				outFile = new FWFile;				outFile.fwOpenWrite(dlFileName,true,'TEXT','R*ch');								var outputcode = fwMarkups["php_code"].toString();				outputcode = outputcode.replace(/__filename__/g,origFileName);								outFile.fwWrite(outputcode);				outFile.fwClose();				fwParameters["php_file"].fwSpecify(outFile);								//create the link				var encLink = img.fwAddEnclosing("a",true);				encLink.href= fwQuote(fwParameters["php_file"].fwValue.toString());												//remove the temp file so we don't use it the next time				fwDeleteFile(dlFileName);				//remove the file references in the controls				fwParameters["php_file"].fwClear();			}		}	</action-javascript></item-action><action name="Force Download (PHP)" preview-text=&link_text;><action-version version="1.0">	Force Download (PHP)		Copyright © Tim Plumb, 2008	Find other great actions at www.freewayactions.com</action-version><action-text name = "link_text" title="Link text" default="download"><action-file name = "file_1" title="Download file" keepwithHTML><action-file var name = "php_file" keepwithHTML><action-include name="ForceDownloadCommon">	<action-javascript>		function fwBeforeEndBody() {			var me = fwDocument.fwTags.fwFind("",fwItem);			if (me){				//create the php file based on the original file name				var origFileName = fwParameters["file_1"].fwValue;				var origFileNameNoExt = origFileName.split(".")[0];				var dlFileName = origFileNameNoExt + "-dl.php";										//create the php file				outFile = new FWFile;				outFile.fwOpenWrite(dlFileName,true,'TEXT','R*ch');								var outputcode = fwMarkups["php_code"].toString();				outputcode = outputcode.replace(/__filename__/g,origFileName);								outFile.fwWrite(outputcode);				outFile.fwClose();				fwParameters["php_file"].fwSpecify(outFile);								//create the link				var rawText =  me.fwAddRaw(fwParameters["link_text"].fwValue);				var encLink = rawText.fwAddEnclosing("a",true);				encLink.href= fwQuote(fwParameters["php_file"].fwValue.toString());												//remove the temp file so we don't use it the next time				fwDeleteFile(dlFileName);				//remove the file references in the controls				fwParameters["php_file"].fwClear();			}		}	</action-javascript></action>